# æ¨¡å‹é—®é¢˜åˆ†æä¸æ”¹è¿›å»ºè®®

## é—®é¢˜1ï¸âƒ£ï¼šåˆå§‹æ¸©åº¦åé«˜ï¼ˆ27Â°C vs 23Â°Cï¼‰

### æ ¹æœ¬åŸå› 

ä»ä»£ç åˆ†æå‘ç°ï¼š

```python
# predict_to_csv_sequence.py ç¬¬124-127è¡Œ
if a0_net is not None:
    with torch.no_grad():
        a0 = a0_net(cond).squeeze(0).detach().cpu().numpy()
    a_pred[0] = a0
```

**é—®é¢˜**ï¼š
- `a0_net` ä½¿ç”¨ `(rpm, ambient)` é¢„æµ‹åˆå§‹PODç³»æ•°
- ä½†è®­ç»ƒæ—¶ï¼Œ`a0_net` å­¦ä¹ çš„æ˜¯**è®­ç»ƒåºåˆ—çš„ç¬¬ä¸€å¸§**ï¼Œè€Œä¸æ˜¯**çœŸæ­£çš„å†·å¯åŠ¨çŠ¶æ€**
- è®­ç»ƒæ•°æ®ä¸­çš„åºåˆ—å¯èƒ½å·²ç»æ˜¯"æ¸©çƒ­"çŠ¶æ€ï¼Œä¸æ˜¯ä»ç¯å¢ƒæ¸©åº¦å¼€å§‹

### è¯æ®

ä»å¯¹æ¯”æ•°æ®çœ‹ï¼š
- **é¢„æµ‹t=0**: 27-33Â°C
- **çœŸå®t=0**: 21-22Â°C (æ¥è¿‘ç¯å¢ƒæ¸©åº¦22.9Â°C)
- **åå·®**: +4-11Â°C

è¿™è¯´æ˜`a0_net`é¢„æµ‹çš„åˆå§‹çŠ¶æ€ç›¸å½“äº"å·²ç»è¿è¡Œäº†ä¸€æ®µæ—¶é—´"çš„çŠ¶æ€ã€‚

---

## é—®é¢˜2ï¸âƒ£ï¼šç³»ç»Ÿæ€§åé«˜ï¼ˆBias = +3.91Â°Cï¼‰

### è§‚å¯Ÿåˆ°çš„ç°è±¡

ä»ä¼ æ„Ÿå™¨å¯¹æ¯”ç»“æœï¼š
- å¹³å‡åå·®ï¼ˆBiasï¼‰ï¼š+3.91Â°C
- æ‰€æœ‰ä¼ æ„Ÿå™¨é¢„æµ‹å€¼éƒ½**æŒç»­åé«˜**
- æŸäº›ä¼ æ„Ÿå™¨ï¼ˆå¦‚ `rear_bearing_outer`ï¼‰MAEè¾¾åˆ°6.5Â°C

### å¯èƒ½åŸå› 

1. **åˆå§‹çŠ¶æ€é”™è¯¯çš„ç´¯ç§¯æ•ˆåº”**
   - åˆå§‹æ¸©åº¦é«˜ â†’ åç»­é¢„æµ‹éƒ½åé«˜
   - çƒ­æƒ¯æ€§å¯¼è‡´è¯¯å·®æŒç»­ä¼ æ’­

2. **ç¨³æ€ vs ç¬æ€æ··æ·†**
   - çœŸå®æ•°æ® `real_steady/9000.csv` æ˜¯**ç¨³æ€å®æµ‹**ï¼ˆå·²è¿è¡Œè‡³çƒ­å¹³è¡¡ï¼‰
   - é¢„æµ‹æ•°æ®æ˜¯**ä»t=0çš„ç¬æ€æ¼”åŒ–**
   - ä¸¤è€…çš„æ—¶é—´èµ·ç‚¹ä¸åŒï¼

3. **ç¯å¢ƒæ¸©åº¦/è¾¹ç•Œæ¡ä»¶**
   - è®­ç»ƒæ—¶çš„ç¯å¢ƒæ¸©åº¦å¯èƒ½ä¸å®æµ‹æ—¶ä¸åŒ
   - å¯¹æµç³»æ•°ç­‰è¾¹ç•Œæ¡ä»¶å¯èƒ½æœ‰åå·®

---

## é—®é¢˜3ï¸âƒ£ï¼šæ—¶é—´å¯¹é½é—®é¢˜

### å…³é”®å‘ç°

```csv
æ—¶é—´(s), é¢„æµ‹æ¸©åº¦, çœŸå®æ¸©åº¦
0,      27-33Â°C,   21-22Â°C  (å†·å¯åŠ¨)
3600,   28-35Â°C,   23-34Â°C  (æ¥è¿‘ç¨³æ€)
```

**é—®é¢˜**ï¼š
- é¢„æµ‹çš„ t=0 â‰  çœŸå®æµ‹é‡çš„ t=0
- é¢„æµ‹æ˜¯"ç¬æ€å‡æ¸©è¿‡ç¨‹"
- çœŸå®æ•°æ®å¯èƒ½æ˜¯"ç¨³æ€è¿è¡Œæ—¶çš„è¿ç»­è®°å½•"

---

## ğŸ”§ æ”¹è¿›å»ºè®®

### æ–¹æ¡ˆAï¼šä¿®æ­£åˆå§‹çŠ¶æ€ï¼ˆæ¨èï¼‰

```python
# 1. æ·»åŠ "å†·å¯åŠ¨"æ¨¡å¼
def get_cold_start_coeffs(Phi, Tbar, ambient_temp):
    """è®¡ç®—å†·å¯åŠ¨æ—¶çš„PODç³»æ•°ï¼ˆæ‰€æœ‰èŠ‚ç‚¹æ¸©åº¦=ç¯å¢ƒæ¸©åº¦ï¼‰"""
    T_cold = np.full_like(Tbar, ambient_temp)  # å…¨éƒ¨è®¾ä¸ºç¯å¢ƒæ¸©åº¦
    a0_cold = Phi.T @ (T_cold - Tbar)
    return a0_cold

# 2. åœ¨é¢„æµ‹æ—¶ä½¿ç”¨
if cold_start:
    a_pred[0] = get_cold_start_coeffs(Phi, Tbar, ambient)
else:
    a_pred[0] = a0_net(cond)  # ç”¨äº"çƒ­å¯åŠ¨"
```

### æ–¹æ¡ˆBï¼šä½¿ç”¨çœŸå®warmupæ•°æ®

```python
# å¦‚æœæœ‰è¯¥rpmçš„çœŸå®æ•°æ®ï¼Œä½¿ç”¨å‰60ç§’ä½œä¸ºwarmup
if rpm in available_rpms:
    real_coeffs = load_real_data(rpm)
    a_pred[:warmup] = real_coeffs[:warmup]
    # ä»ç¬¬60ç§’å¼€å§‹é¢„æµ‹
    for t in range(warmup, T_len):
        ...
```

### æ–¹æ¡ˆCï¼šå¯¹æ¯”ç¨³æ€è€Œéç¬æ€

```python
# é¢„æµ‹åˆ°ç¨³æ€ï¼ˆ3600ç§’ï¼‰åå†ä¸çœŸå®ç¨³æ€æ•°æ®å¯¹æ¯”
pred_steady = a_pred[-100:].mean(axis=0)  # æœ€å100ç§’å¹³å‡
T_pred_steady = Tbar + pred_steady @ Phi.T

# ä¸real_steadyæ•°æ®å¯¹æ¯”
compare_with_real_steady(T_pred_steady, real_data)
```

### æ–¹æ¡ˆDï¼šé‡æ–°è®­ç»ƒa0_net

```python
# è®­ç»ƒæ—¶æ˜ç¡®åŒºåˆ†"å†·å¯åŠ¨"æ ·æœ¬
# dataset_transient.py ä¸­æ·»åŠ æ ‡è®°
item["is_cold_start"] = torch.tensor(
    1 if start == 0 and èµ·å§‹æ¸©åº¦æ¥è¿‘ç¯å¢ƒæ¸©åº¦ else 0
)

# ä»…ç”¨å†·å¯åŠ¨æ ·æœ¬è®­ç»ƒa0_net
if is_cold_start.sum() > 0:
    a0_loss = criterion(a0_pred[is_cold_start], a0_target[is_cold_start])
```

---

## ğŸ“Š å»ºè®®çš„ä»£ç æ”¹è¿›ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³ä¿®å¤ï¼‰

1. **ä¿®æ­£åˆå§‹åŒ–é€»è¾‘**
   ```python
   # æ·»åŠ å‚æ•°æ§åˆ¶å†·å¯åŠ¨
   def predict_sequence(..., cold_start=True):
       if cold_start:
           # ä½¿ç”¨ç¯å¢ƒæ¸©åº¦åˆå§‹åŒ–
           a_pred[0] = get_cold_start_coeffs(...)
   ```

2. **æ˜ç¡®å¯¹æ¯”åœºæ™¯**
   - åŒºåˆ†"ç¬æ€é¢„æµ‹ vs ç¬æ€å®æµ‹"
   - å’Œ"ç¨³æ€é¢„æµ‹ vs ç¨³æ€å®æµ‹"
   - å½“å‰å¯¹æ¯”çš„æ˜¯ï¼šç¬æ€é¢„æµ‹ vs ç¨³æ€å®æµ‹ï¼ˆä¸åˆç†ï¼‰

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆæå‡ç²¾åº¦ï¼‰

3. **æ”¹è¿›warmupç­–ç•¥**
   - ä½¿ç”¨å‰60ç§’çœŸå®æ•°æ®åˆå§‹åŒ–
   - æˆ–å¢åŠ warmupæ—¶é—´åˆ°300ç§’

4. **ä¼ æ„Ÿå™¨ä½ç½®ç›‘ç£å¼ºåŒ–**
   - è®­ç»ƒæ—¶å¢åŠ ä¼ æ„Ÿå™¨ä½ç½®çš„æƒé‡
   - å½“å‰ `sensor_loss_weight=10.0` å¯èƒ½ä¸å¤Ÿ

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

5. **ç‰©ç†çº¦æŸå¢å¼º**
   - æ£€æŸ¥çƒ­ä¼ å¯¼æ®‹å·®è®¡ç®—
   - ç¡®ä¿è¾¹ç•Œæ¡ä»¶æ­£ç¡®

6. **æ•°æ®å¢å¼º**
   - æ”¶é›†æ›´å¤šå†·å¯åŠ¨æ•°æ®
   - æˆ–äººå·¥ç”Ÿæˆå†·å¯åŠ¨æ ·æœ¬

---

## ğŸ¯ å…·ä½“æ”¹è¿›ä»£ç 

### æ”¹è¿›1ï¼šæ·»åŠ å†·å¯åŠ¨æ”¯æŒ

```python
# predict_to_csv_sequence.py
def get_cold_start_initial_coeffs(Phi, Tbar, ambient):
    """è®¡ç®—å†·å¯åŠ¨åˆå§‹PODç³»æ•°"""
    T_cold = np.full_like(Tbar, ambient)
    return Phi.T @ (T_cold - Tbar)

def predict_sequence(..., use_cold_start=True):
    ...
    if use_cold_start:
        a_pred[0] = get_cold_start_initial_coeffs(Phi, Tbar, ambient)
        print(f"ä½¿ç”¨å†·å¯åŠ¨åˆå§‹åŒ–ï¼Œç¯å¢ƒæ¸©åº¦={ambient}Â°C")
    elif a0_net is not None:
        a_pred[0] = a0_net(cond).cpu().numpy()
        print(f"ä½¿ç”¨a0_netåˆå§‹åŒ–")
```

### æ”¹è¿›2ï¼šä¿®æ­£å¯¹æ¯”é€»è¾‘

```python
# compare_sensor_predictions.py
# æ·»åŠ é€‰é¡¹ï¼šå¯¹æ¯”ç¨³æ€è¿˜æ˜¯ç¬æ€
@dataclass
class CompareConfig:
    compare_mode: str = "transient"  # "transient" æˆ– "steady"
    steady_start_time: int = 3000    # ç¨³æ€å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰
    
def extract_predicted_temps(...):
    if cfg.compare_mode == "steady":
        # åªå–æœ€åNç§’çš„å¹³å‡å€¼
        temps = temps[-100:].mean(axis=0)
```

---

## ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ

é‡‡ç”¨**æ–¹æ¡ˆAï¼ˆå†·å¯åŠ¨ä¿®æ­£ï¼‰**åï¼š

- âœ… åˆå§‹æ¸©åº¦è¯¯å·®ï¼š8Â°C â†’ <1Â°C
- âœ… æ€»ä½“MAEï¼š4.1Â°C â†’ <2.0Â°C
- âœ… Biasï¼š+3.9Â°C â†’ <0.5Â°C

é‡‡ç”¨**æ–¹æ¡ˆCï¼ˆç¨³æ€å¯¹æ¯”ï¼‰**åï¼š

- âœ… æ›´åˆç†çš„å¯¹æ¯”åŸºå‡†
- âœ… æ¶ˆé™¤æ—¶é—´æ¼”åŒ–çš„ç´¯ç§¯è¯¯å·®
- âœ… éªŒè¯æ¨¡å‹çš„é•¿æœŸé¢„æµ‹èƒ½åŠ›

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å®æ–½**ï¼šæ·»åŠ å†·å¯åŠ¨é€‰é¡¹åˆ°é¢„æµ‹è„šæœ¬
2. **é‡æ–°é¢„æµ‹**ï¼šç”¨å†·å¯åŠ¨æ¨¡å¼ç”Ÿæˆ9000è½¬æ•°æ®
3. **é‡æ–°å¯¹æ¯”**ï¼šæŸ¥çœ‹æ”¹è¿›æ•ˆæœ
4. **è¯„ä¼°å†³ç­–**ï¼šæ ¹æ®ç»“æœå†³å®šæ˜¯å¦éœ€è¦é‡æ–°è®­ç»ƒ

éœ€è¦æˆ‘å¸®ä½ å®ç°è¿™äº›æ”¹è¿›å—ï¼Ÿ

